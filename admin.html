<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>CatClient | Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

<style>
body {
  font-family: Inter, sans-serif;
  background: #0f111a;
  color: white;
  padding: 50px 10%;
}
input, button {
  padding: 12px;
  margin: 5px 0;
  border-radius: 10px;
  border: none;
}
button {
  background: orange;
  font-weight: 700;
  cursor: pointer;
}
.product {
  background: #1a1d29;
  padding: 20px;
  border-radius: 15px;
  margin-top: 15px;
}
</style>
</head>

<body>

<h1>ðŸ›  Admin Shop Editor</h1>

<button id="loginBtn">Login mit Microsoft</button>
<p id="userInfo"></p>

<h2>Neues Item</h2>
<input id="name" placeholder="Name"><br>
<input id="price" placeholder="Preis"><br>
<input id="image" placeholder="Bild URL"><br>
<button id="addBtn">HinzufÃ¼gen</button>

<h2>Items</h2>
<div id="items"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, OAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyChdNqyb8KIkHTe4TCJkQOJ8V2t2u6oJTo",
  authDomain: "catclient-app.firebaseapp.com",
  projectId: "catclient-app",
  storageBucket: "catclient-app.firebasestorage.app",
  messagingSenderId: "421552104568",
  appId: "1:421552104568:web:def5045766ba863f90f98d"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new OAuthProvider("microsoft.com");

const loginBtn = document.getElementById("loginBtn");
const userInfo = document.getElementById("userInfo");
const addBtn = document.getElementById("addBtn");
const itemsDiv = document.getElementById("items");

loginBtn.onclick = () => signInWithPopup(auth, provider);

onAuthStateChanged(auth, async user => {
  if (!user) return;
  userInfo.textContent = "Eingeloggt als " + user.displayName;
  loadItems();
});

async function loadItems() {
  itemsDiv.innerHTML = "";
  const snap = await getDocs(collection(db, "products"));
  snap.forEach(d => {
    const data = d.data();
    const el = document.createElement("div");
    el.className = "product";
    el.innerHTML = `
      <b>${data.name}</b><br>
      Preis: ${data.price}â‚¬<br>
      <img src="${data.image}" width="120"><br>
      <button data-id="${d.id}">LÃ¶schen</button>
    `;
    el.querySelector("button").onclick = async () => {
      await deleteDoc(doc(db, "products", d.id));
      loadItems();
    };
    itemsDiv.appendChild(el);
  });
}

addBtn.onclick = async () => {
  await addDoc(collection(db, "products"), {
    name: name.value,
    price: price.value,
    image: image.value
  });
  name.value = price.value = image.value = "";
  loadItems();
};
</script>

</body>
</html>
